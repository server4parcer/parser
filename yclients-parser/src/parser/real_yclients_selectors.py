# –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ YClients
# –û—Å–Ω–æ–≤—ã–≤–∞—é—Ç—Å—è –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã HTML

# –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ YClients —Å–∞–π—Ç–∞
REAL_YCLIENTS_SELECTORS = {
    # –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ü–µ–Ω—ã - –ò–ó–ë–ï–ì–ê–ï–ú —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º!
    "price_selectors": [
        # –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ü–µ–Ω—ã –Ω–∞ YClients
        "[data-price]",                    # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-price
        ".service-price",                  # –ö–ª–∞—Å—Å service-price
        ".booking-price",                  # –ö–ª–∞—Å—Å booking-price  
        ".price-value",                    # –ö–ª–∞—Å—Å price-value
        ".cost",                          # –ö–ª–∞—Å—Å cost
        ".amount",                        # –ö–ª–∞—Å—Å amount
        ".fee",                           # –ö–ª–∞—Å—Å fee
        ".tariff",                        # –ö–ª–∞—Å—Å tariff
        
        # –ë–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è YClients
        ".record-service-price",          # YClients —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π
        ".yclients-price",               # YClients —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π
        ".slot-price-info",              # –°–ª–æ—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ü–µ–Ω–µ
        ".booking-cost-info",            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        
        # –ß–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç (–ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
        "*[title*='—Ü–µ–Ω–∞']",              # –≠–ª–µ–º–µ–Ω—Ç —Å title —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "—Ü–µ–Ω–∞"
        "*[title*='—Å—Ç–æ–∏–º–æ—Å—Ç—å']",         # –≠–ª–µ–º–µ–Ω—Ç —Å title —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "—Å—Ç–æ–∏–º–æ—Å—Ç—å"
        "*[title*='price']",             # –≠–ª–µ–º–µ–Ω—Ç —Å title —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "price"
    ],
    
    # –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    "provider_selectors": [
        # –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        "[data-staff]",                   # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-staff
        "[data-staff-name]",             # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-staff-name
        "[data-specialist]",             # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-specialist
        "[data-master]",                 # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-master
        "[data-employee]",               # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-employee
        
        ".staff-name",                   # –ö–ª–∞—Å—Å staff-name
        ".specialist-name",              # –ö–ª–∞—Å—Å specialist-name
        ".master-name",                  # –ö–ª–∞—Å—Å master-name
        ".employee-name",                # –ö–ª–∞—Å—Å employee-name
        ".provider-name",                # –ö–ª–∞—Å—Å provider-name
        ".worker-name",                  # –ö–ª–∞—Å—Å worker-name
        
        # –ë–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è YClients
        ".record-staff-name",            # YClients —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π
        ".yclients-staff",              # YClients —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π
        ".booking-specialist",           # –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        ".service-provider",             # –ü—Ä–æ–≤–∞–π–¥–µ—Ä —É—Å–ª—É–≥–∏
        
        # –ß–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç –∏ title
        "*[title*='—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç']",        # –≠–ª–µ–º–µ–Ω—Ç —Å title —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç"
        "*[title*='–º–∞—Å—Ç–µ—Ä']",           # –≠–ª–µ–º–µ–Ω—Ç —Å title —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "–º–∞—Å—Ç–µ—Ä"
        "*[title*='—Å–æ—Ç—Ä—É–¥–Ω–∏–∫']",        # –≠–ª–µ–º–µ–Ω—Ç —Å title —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "—Å–æ—Ç—Ä—É–¥–Ω–∏–∫"
    ],
    
    # –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ (—á—Ç–æ–±—ã –ù–ï –ø—É—Ç–∞—Ç—å —Å —Ü–µ–Ω–æ–π)
    "time_selectors": [
        "[data-time]",                   # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-time
        ".time",                         # –ö–ª–∞—Å—Å time
        ".slot-time",                    # –ö–ª–∞—Å—Å slot-time
        ".booking-time",                 # –ö–ª–∞—Å—Å booking-time
        ".schedule-time",                # –ö–ª–∞—Å—Å schedule-time
        ".appointment-time",             # –ö–ª–∞—Å—Å appointment-time
    ],
    
    # –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
    "time_slot_selectors": [
        ".time-slot",                    # –ö–ª–∞—Å—Å time-slot
        ".booking-slot",                 # –ö–ª–∞—Å—Å booking-slot
        ".schedule-slot",                # –ö–ª–∞—Å—Å schedule-slot
        ".appointment-slot",             # –ö–ª–∞—Å—Å appointment-slot
        ".available-slot",               # –ö–ª–∞—Å—Å available-slot
        "[data-slot]",                   # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-slot
    ],
    
    # –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –¥–∞—Ç
    "date_selectors": [
        "[data-date]",                   # –≠–ª–µ–º–µ–Ω—Ç —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-date
        ".date",                         # –ö–ª–∞—Å—Å date
        ".calendar-date",                # –ö–ª–∞—Å—Å calendar-date
        ".booking-date",                 # –ö–ª–∞—Å—Å booking-date
    ],
    
    # –ò—Å–∫–ª—é—á–µ–Ω–∏—è - —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–µ–Ω—É
    "price_exclude_selectors": [
        ".time",                         # –ò—Å–∫–ª—é—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏
        ".clock",                        # –ò—Å–∫–ª—é—á–∞–µ–º —á–∞—Å—ã
        ".duration",                     # –ò—Å–∫–ª—é—á–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
        "[data-time]",                   # –ò—Å–∫–ª—é—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-time
        ".slot-time",                    # –ò—Å–∫–ª—é—á–∞–µ–º –≤—Ä–µ–º—è —Å–ª–æ—Ç–æ–≤
    ]
}

# –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
VALIDATION_PATTERNS = {
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ü–µ–Ω—ã (–¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–∞–ª—é—Ç—É –∏–ª–∏ —è–≤–Ω–æ —Ü–µ–Ω—É)
    "price_patterns": [
        r'\d+\s*(?:‚ÇΩ|—Ä—É–±|—Ä—É–±–ª–µ–π?|—Ä\.?)\s*',                    # –†—É–±–ª–∏
        r'\d+\s*(?:\$|USD|–¥–æ–ª–ª–∞—Ä–æ–≤?)\s*',                      # –î–æ–ª–ª–∞—Ä—ã  
        r'\d+\s*(?:‚Ç¨|EUR|–µ–≤—Ä–æ)\s*',                           # –ï–≤—Ä–æ
        r'(?:‚ÇΩ|—Ä—É–±|—Ä—É–±–ª–µ–π?|—Ä\.?)\s*\d+',                      # –í–∞–ª—é—Ç–∞ –ø–µ—Ä–µ–¥ —á–∏—Å–ª–æ–º
        r'(?:\$|USD|–¥–æ–ª–ª–∞—Ä–æ–≤?)\s*\d+',                        # –î–æ–ª–ª–∞—Ä—ã –ø–µ—Ä–µ–¥ —á–∏—Å–ª–æ–º
        r'(?:‚Ç¨|EUR|–µ–≤—Ä–æ)\s*\d+',                              # –ï–≤—Ä–æ –ø–µ—Ä–µ–¥ —á–∏—Å–ª–æ–º
        r'(?:—Ü–µ–Ω–∞|—Å—Ç–æ–∏–º–æ—Å—Ç—å|price|cost)[:=]\s*\d+',           # "—Ü–µ–Ω–∞: 1500"
        r'\d+\s*(?:—Ç–µ–Ω–≥–µ|—Ç–≥)',                                # –¢–µ–Ω–≥–µ
    ],
    
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ (–∏—Å–∫–ª—é—á–∞–µ–º –∏–∑ —Ü–µ–Ω—ã)
    "time_patterns": [
        r'\b([01]?\d|2[0-3]):([0-5]\d)\b',                    # HH:MM —Ñ–æ—Ä–º–∞—Ç
        r'\b([01]?\d|2[0-3])\s*—á\s*([0-5]\d)?\s*–º?\b',       # "14—á 30–º" —Ñ–æ—Ä–º–∞—Ç
        r'\b(1[0-2]|0?[1-9])\s*(AM|PM)\b',                    # 12-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç
    ],
    
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∏–º–µ–Ω (–≤–∞–ª–∏–¥–Ω—ã–µ –∏–º–µ–Ω–∞)
    "name_patterns": [
        r'\b[–ê-–Ø–Å][–∞-—è—ë]+(?:\s+[–ê-–Ø–Å][–∞-—è—ë]+)*\b',           # –†—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞
        r'\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b',               # –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –∏–º–µ–Ω–∞
        r'\b[–ê-–Ø–ÅA-Z][–∞-—è—ëa-z]+(?:\s+[–ê-–Ø–ÅA-Z]\.?\s*)*[–ê-–Ø–ÅA-Z][–∞-—è—ëa-z]+\b', # –ò–º—è —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏
    ],
    
    # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –∏–º–µ–Ω (–Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–º–µ–Ω–∞–º–∏)
    "name_exclude_patterns": [
        r'^\d+$',                                             # –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
        r'\d+\s*(?:‚ÇΩ|—Ä—É–±|—Ä—É–±–ª–µ–π?|—Ä\.?|\$|‚Ç¨)',                # –¶–µ–Ω—ã
        r'\b([01]?\d|2[0-3]):([0-5]\d)\b',                   # –í—Ä–µ–º—è
        r'^(–Ω–µ\s+—É–∫–∞–∑–∞–Ω|–Ω–µ\s+–≤—ã–±—Ä–∞–Ω|–Ω–µ—Ç\s+–¥–∞–Ω–Ω—ã—Ö)$',         # –ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    ]
}

async def find_best_selector_for_element(page, selector_list, element_description="—ç–ª–µ–º–µ–Ω—Ç"):
    """
    –ù–∞—Ö–æ–¥–∏—Ç –ª—É—á—à–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    """
    import logging
    logger = logging.getLogger(__name__)
    
    for selector in selector_list:
        try:
            elements = await page.query_selector_all(selector)
            if elements:
                # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                for element in elements[:3]:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–µ 3 —ç–ª–µ–º–µ–Ω—Ç–∞
                    text = await element.text_content()
                    if text and text.strip():
                        logger.info(f"‚úÖ –†–∞–±–æ—á–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è {element_description}: {selector} (–Ω–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)")
                        return selector
        except Exception as e:
            logger.debug(f"üîç –°–µ–ª–µ–∫—Ç–æ—Ä {selector} –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: {str(e)}")
    
    logger.warning(f"‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ä–∞–±–æ—á–∏—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è {element_description}")
    return None

def is_valid_price(text):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –≤–∞–ª–∏–¥–Ω–æ–π —Ü–µ–Ω–æ–π."""
    import re
    
    if not text:
        return False
    
    text = text.strip()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –Ω–µ –≤—Ä–µ–º—è
    for pattern in VALIDATION_PATTERNS["time_patterns"]:
        if re.search(pattern, text):
            return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ü–µ–Ω—É
    for pattern in VALIDATION_PATTERNS["price_patterns"]:
        if re.search(pattern, text, re.IGNORECASE):
            return True
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ —Å –≤–æ–∑–º–æ–∂–Ω–æ–π –≤–∞–ª—é—Ç–æ–π
    if re.search(r'\d+', text):
        return True
    
    return False

def is_valid_name(text):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –≤–∞–ª–∏–¥–Ω—ã–º –∏–º–µ–Ω–µ–º."""
    import re
    
    if not text:
        return False
    
    text = text.strip()
    
    # –ò—Å–∫–ª—é—á–∞–µ–º —è–≤–Ω–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∏–º–µ–Ω–∞
    for pattern in VALIDATION_PATTERNS["name_exclude_patterns"]:
        if re.search(pattern, text, re.IGNORECASE):
            return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–º–µ–Ω
    for pattern in VALIDATION_PATTERNS["name_patterns"]:
        if re.search(pattern, text):
            return True
    
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å—Ç—å –±—É–∫–≤—ã –∏ –¥–ª–∏–Ω–∞ –±–æ–ª—å—à–µ 2
    if len(text) >= 2 and re.search(r'[–ê-–Ø–∞-—èA-Za-z]', text):
        return True
    
    return False
